generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model brand {
  id         Int       @id @default(autoincrement())
  name       String    @unique(map: "Brand_name_key")
  createdAt  DateTime  @default(now())
  updatedAt  DateTime  @updatedAt
  categoryId Int?
  category   category? @relation(fields: [categoryId], references: [id], map: "Brand_categoryId_fkey")
  product    product[]

  @@index([categoryId], map: "Brand_categoryId_fkey")
}

model category {
  id        Int      @id @default(autoincrement())
  name      String   @unique(map: "Category_name_key")
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  brand     brand[]
}

model emailverification {
  id         Int       @id @default(autoincrement())
  email      String
  code       String
  expiresAt  DateTime
  verified   Boolean   @default(false)
  createdAt  DateTime  @default(now())
  verifiedAt DateTime?
  userId     Int
  user       user      @relation(fields: [userId], references: [id], map: "EmailVerification_userId_fkey")

  @@index([code, expiresAt], map: "EmailVerification_code_expiresAt_idx")
  @@index([userId], map: "EmailVerification_userId_fkey")
}

model passwordreset {
  id        Int      @id @default(autoincrement())
  userId    Int
  expiresAt DateTime
  used      Boolean  @default(false)
  createdAt DateTime @default(now())
  code      String
  user      user     @relation(fields: [userId], references: [id], map: "PasswordReset_userId_fkey")

  @@index([code, expiresAt], map: "PasswordReset_code_expiresAt_idx")
  @@index([userId], map: "PasswordReset_userId_fkey")
}

model product {
  id              Int               @id @default(autoincrement())
  name            String
  price           Float
  stock           Int               @default(0)
  imageUrl        String?
  createdAt       DateTime          @default(now())
  brandId         Int?
  updatedAt       DateTime          @updatedAt
  brand           brand?            @relation(fields: [brandId], references: [id], map: "Product_brandId_fkey")
  transactionitem transactionitem[]

  @@index([brandId], map: "Product_brandId_fkey")
  @@index([name], map: "Product_name_idx")
}

model registrationpin {
  id          Int       @id @default(autoincrement())
  code        String    @unique(map: "RegistrationPin_code_key")
  expiresAt   DateTime
  used        Boolean   @default(false)
  createdById Int
  createdAt   DateTime  @default(now())
  usedAt      DateTime?
  revokedAt   DateTime?
  revokedById Int?
  user        user      @relation(fields: [createdById], references: [id], map: "RegistrationPin_createdById_fkey")

  @@index([createdById], map: "RegistrationPin_createdById_fkey")
}

model transaction {
  id              Int                @id @default(autoincrement())
  cashierId       Int
  total           Float
  createdAt       DateTime           @default(now())
  status          transaction_status @default(DRAFT)
  changeAmount    Float?
  completedAt     DateTime?
  paymentAmount   Float?
  paymentMethod   payment_method?    @default(CASH)
  user            user               @relation(fields: [cashierId], references: [id], map: "Transaction_cashierId_fkey")
  transactionitem transactionitem[]

  @@index([cashierId], map: "Transaction_cashierId_idx")
  @@index([createdAt], map: "Transaction_createdAt_idx")
}

model transactionitem {
  id            Int         @id @default(autoincrement())
  transactionId Int
  productId     Int
  quantity      Int
  price         Float
  subtotal      Float
  product       product     @relation(fields: [productId], references: [id], map: "TransactionItem_productId_fkey")
  transaction   transaction @relation(fields: [transactionId], references: [id], onDelete: Cascade, map: "TransactionItem_transactionId_fkey")

  @@index([productId], map: "TransactionItem_productId_fkey")
  @@index([transactionId], map: "TransactionItem_transactionId_idx")
}

model store {
  id          Int      @id @default(autoincrement())
  name        String   @default("KasirGO")
  address     String?  @db.Text
  phone       String?
  email       String?
  logoUrl     String?
  description String?  @db.Text
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model user {
  id                Int                 @id @default(autoincrement())
  email             String              @unique(map: "User_email_key")
  password          String?
  role              user_role           @default(CASHIER)
  isVerified        Boolean             @default(false)
  createdAt         DateTime            @default(now())
  updatedAt         DateTime            @updatedAt
  userName          String              @unique(map: "User_userName_key")
  emailverification emailverification[]
  passwordreset     passwordreset[]
  registrationpin   registrationpin[]
  transaction       transaction[]
}

enum transaction_status {
  DRAFT
  LOCKED
  COMPLETED
}

enum payment_method {
  CASH
  QRIS
  DEBIT
}

enum user_role {
  ADMIN
  CASHIER
}
